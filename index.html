<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Calendar</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-gray-50 p-4">
    <div class="mx-auto">
      <div class="mb-4 flex justify-start gap-[20%]">
        <div class="mb-4">
          <button
            id="addEventBtn"
            class="bg-blue-500 hover:bg-blue-600 text-white font-semibold px-6 py-2 rounded-lg shadow-md transition duration-200"
          >
            + Add Event
          </button>
        </div>

        <input
          type="text"
          id="searchInput"
          placeholder="Rechercher par nom..."
          class="border border-gray-300 rounded-full w-[50%] px-4 py-2 focus:outline-none focus:ring-2 focus:ring-purple-500"
        />
      </div>

      <div
        id="Modal"
        class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 overflow-y-auto p-4"
      >
        <div
          class="bg-white rounded-lg shadow-xl p-6 w-full max-w-md max-h-[90vh] overflow-y-auto"
        >
          <h2 class="text-2xl font-bold mb-4 text-gray-800">Add New Event</h2>
          <form id="eventForm">
            <div class="mb-4">
              <label class="block text-gray-700 font-semibold mb-2"
                >Client name</label
              >
              <input
                type="text"
                id="clientName"
                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                required
              />
            </div>
            <div class="mb-4">
              <label class="block text-gray-700 font-semibold mb-2">Date</label>
              <input
                type="date"
                id="eventDate"
                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                required
              />
            </div>
            <div class="mb-4">
              <label class="block text-gray-700 font-semibold mb-2"
                >Start Time</label
              >
              <input
                type="time"
                id="startDate"
                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                required
              />
            </div>
            <div class="mb-4">
              <label class="block text-gray-700 font-semibold mb-2"
                >End Time</label
              >
              <input
                type="time"
                id="endDate"
                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                required
              />
            </div>
            <div class="mb-4">
              <label class="block text-gray-700 font-semibold mb-2"
                >Nombre de personne</label
              >
              <input
                type="number"
                id="members"
                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                required
              />
            </div>
            <div class="mb-4">
              <label class="block text-gray-700 font-semibold mb-2"
                >Type</label
              >
              <select
                id="type"
                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"
                required
              >
                <option value="">Select type...</option>
                <option value="vip">ðŸ”´VIP</option>
                <option value="sur-place">ðŸŸ¢Sur Place</option>
                <option value="anniversaire">ðŸŸ Anniversaire</option>
                <option value="work-meeting">ðŸ”µWork Meeting</option>
              </select>
            </div>
            <div class="flex gap-3">
              <button
                type="submit"
                class="flex-1 bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 rounded-lg transition duration-200"
              >
                Add Event
              </button>
              <button
                type="button"
                id="cancelBtn"
                class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold py-2 rounded-lg transition duration-200"
              >
                Cancel
              </button>
            </div>
          </form>
        </div>
      </div>

      <div class="bg-white rounded-lg shadow-lg overflow-hidden">
        <div class="bg-white p-4 flex items-center justify-between border-b">
          <button
            id="prevWeek"
            class="text-gray-600 text-2xl font-bold hover:bg-gray-100 w-10 h-10 rounded-lg transition duration-200"
          >
            â€¹
          </button>
          <h1 id="weekRange" class="text-gray-800 text-xl font-semibold">
            Week View
          </h1>
          <button
            id="nextWeek"
            class="text-gray-600 text-2xl font-bold hover:bg-gray-100 w-10 h-10 rounded-lg transition duration-200"
          >
            â€º
          </button>
        </div>

        <div class="overflow-x-auto">
          <table class="w-full border-collapse">
            <thead>
              <tr class="bg-gray-50">
                <th
                  class="border border-gray-200 p-3 text-left text-xs font-medium text-gray-500 w-24"
                >
                  <div>GMT+01</div>
                </th>
                <th
                  id="day0"
                  class="border border-gray-200 p-3 text-center min-w-32"
                >
                  <div class="text-xs font-medium text-gray-500">SUN</div>
                  <div class="text-2xl font-semibold text-gray-800 mt-1">
                    26
                  </div>
                </th>
                <th
                  id="day1"
                  class="border border-gray-200 p-3 text-center min-w-32"
                >
                  <div class="text-xs font-medium text-gray-500">MON</div>
                  <div class="text-2xl font-semibold text-gray-800 mt-1">
                    27
                  </div>
                </th>
                <th
                  id="day2"
                  class="border border-gray-200 p-3 text-center min-w-32"
                >
                  <div class="text-xs font-medium text-gray-500">TUE</div>
                  <div class="text-2xl font-semibold text-gray-800 mt-1">
                    28
                  </div>
                </th>
                <th
                  id="day3"
                  class="border border-gray-200 p-3 text-center min-w-32"
                >
                  <div class="text-xs font-medium text-blue-500">WED</div>
                  <div
                    class="text-2xl font-semibold text-white bg-blue-500 rounded-full w-12 h-12 flex items-center justify-center mx-auto mt-1"
                  >
                    29
                  </div>
                </th>
                <th
                  id="day4"
                  class="border border-gray-200 p-3 text-center min-w-32"
                >
                  <div class="text-xs font-medium text-gray-500">THU</div>
                  <div class="text-2xl font-semibold text-gray-800 mt-1">
                    30
                  </div>
                </th>
                <th
                  id="day5"
                  class="border border-gray-200 p-3 text-center min-w-32"
                >
                  <div class="text-xs font-medium text-gray-500">FRI</div>
                  <div class="text-2xl font-semibold text-gray-800 mt-1">
                    31
                  </div>
                </th>
                <th
                  id="day6"
                  class="border border-gray-200 p-3 text-center min-w-32"
                >
                  <div class="text-xs font-medium text-gray-500">SAT</div>
                  <div class="text-2xl font-semibold text-gray-800 mt-1">1</div>
                </th>
              </tr>
            </thead>
            <tbody id="calendarBody">
              <!-- Time slots will be generated by JavaScript -->
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <script>
      const modal = document.getElementById("Modal");
      const eventForm = document.getElementById('eventForm'); 
      let weekStart = new Date(2025, 10, 29);
      weekStart.setHours(0, 0, 0, 0);
      const monthNames = [
        "January",
        "February",
        "March",
        "April",
        "May",
        "June",
        "July",
        "August",
        "September",
        "October",
        "November",
        "December",
      ];
      const dayNames = ["SUN", "MON", "TUE", "WED", "THU", "FRI", "SAT"];

      function renderWeekHeader() {
        const weekDates = [];
        for (let i = 0; i < 7; i++) {
          const date = new Date(weekStart);
          date.setDate(weekStart.getDate() + i);
          weekDates.push(date);
        }

        weekDates.forEach((date, index) => {
          const header = document.getElementById(`day${index}`);
          const isToday =
            date.toDateString() === new Date(2025, 10, 29).toDateString();
          header.innerHTML = `
           <div class="text-xs font-medium ${
             isToday ? "text-blue-500" : "text-gray-500"
           }">${dayNames[index]}</div>
           <div class="text-2xl font-semibold ${
             isToday
               ? "text-white bg-blue-500 rounded-full w-12 h-12 flex items-center justify-center mx-auto mt-1"
               : "text-gray-800 mt-1"
           }">${date.getDate()}</div>
           `;
        });

        const endDate = new Date(weekDates[6]);
        document.getElementById("weekRange").textContent = ` ${
          monthNames[weekDates[0].getMonth()]
        } ${weekDates[0].getDate()} - ${
          monthNames[endDate.getMonth()]
        } ${endDate.getDate()} ${weekDates[0].getFullYear()}`;
      }

      function renderHours() {
        const calendarBody = document.getElementById("calendarBody");
        calendarBody.innerHTML = " ";

        for (let h = 0; h < 24; h++) {
          const row = document.createElement("tr");
          const hours = document.createElement("td");
          hours.className =
            "border border-gray-200 p-2 text-xs text-gray-500 font-medium bg-gray-50";

          const displayHour = h === 0 ? 12 : h > 12 ? h - 12 : h;
          const ampm = h < 12 ? "AM" : "PM";
          hours.textContent = `${displayHour} ${ampm}`;
          row.appendChild(hours);

          for (let d = 0; d < 7; d++) {
            const cell = document.createElement("td");
            cell.className =
              "border border-gray-200 h-16 hover:bg-gray-50 transition duration-150 relative"; // ADDED relative
            cell.setAttribute('data-day', d);
            cell.setAttribute('data-hour', h);
            row.appendChild(cell);
          }

          calendarBody.appendChild(row);
        }
      }

      document.getElementById("nextWeek").addEventListener("click", () => {
        weekStart.setDate(weekStart.getDate() + 7);
        renderWeekHeader();
        displayEvents();
      });

      document.getElementById("prevWeek").addEventListener("click", () => {
        weekStart.setDate(weekStart.getDate() - 7);
        renderWeekHeader();
        displayEvents(); 
      });

      document.getElementById("addEventBtn").addEventListener("click", () => {
        modal.classList.remove("hidden");
      });

      document.getElementById("cancelBtn").addEventListener("click", () => {
        modal.classList.add("hidden");
        document.getElementById("eventForm").reset();
      });

      modal.addEventListener("click", (e) => {
        if (e.target.id === "Modal") {
          modal.classList.add("hidden");
          document.getElementById("eventForm").reset();
        }
      });

      function addEvent(event){
        let events = JSON.parse(localStorage.getItem("events")) || [];
        events.push(event); 
        localStorage.setItem("events" , JSON.stringify(events)); 
        console.log('data saved successfully'); 
      }
       
      eventForm.addEventListener('submit', function(e){
        e.preventDefault(); 

        const eventDateValue = document.getElementById("eventDate").value;
        const event = {
            client: document.getElementById("clientName").value,
            eventDate: eventDateValue,  
            startDate: document.getElementById("startDate").value,
            endDate: document.getElementById("endDate").value,
            members: document.getElementById("members").value,
            type: document.getElementById("type").value,
            dayIndex: new Date(eventDateValue).getDay() 
        };
                               
        addEvent(event); 
        displayEvents();
        modal.classList.add('hidden');
        eventForm.reset();
      });

      function getTypeColor(type) {
        const colors = {
          'vip': 'bg-red-500',
          'sur-place': 'bg-green-500',
          'anniversaire': 'bg-orange-500',
          'work-meeting': 'bg-blue-500'
        };
        return colors[type] || 'bg-blue-500';
      }

      function displayEvents(){
        document.querySelectorAll('.event-item').forEach(el => el.remove());
        
        const events = JSON.parse(localStorage.getItem("events")) || [];
        console.log('Displaying events:', events);
        
        events.forEach(event => {   
            const eventDate = new Date(event.eventDate); // FIXED: was e.date
            const startHour = parseInt(event.startDate.split(":")[0]); // FIXED: was e.startDate
            
            const dayOfWeek = eventDate.getDay(); 
            
            const weekEnd = new Date(weekStart);
            weekEnd.setDate(weekStart.getDate() + 6);
            
            if (eventDate >= weekStart && eventDate <= weekEnd) {
                const cell = document.querySelector(`[data-day="${dayOfWeek}"][data-hour="${startHour}"]`);

                if(cell){
                    const eventDiv = document.createElement('div');
                    eventDiv.className = `event-item absolute inset-1 ${getTypeColor(event.type)} text-white text-xs p-1 rounded shadow overflow-hidden`;
                    eventDiv.textContent = `${event.client} (${event.type})`;
                    cell.appendChild(eventDiv);
                }
            }
        });
      }
      
      renderHours();
      renderWeekHeader();
      displayEvents();
    </script>
  </body>
</html>